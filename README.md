# Horae - 时光记忆 v1.3.0 | SillyTavern 记忆增强插件

![Image](https://github.com/SenriYuki/SillyTavern-Horae/blob/main/HoraeLogo.jpg)

> *Horae（荷赖）— 希腊神话中掌管时序的女神*

长篇 RP 玩家的老毛病你一定遇到过 —— AI 的记忆约等于金鱼：昨天的事说成今天早上，连几天前发生的事都永远说是昨天；上一幕穿校服下一幕突然便服；NPC关系倒置；送出去的礼物凭空消失，丢掉的东西又回到手里。

**Horae 用结构化的时间锚点，给你的 AI 装上一本靠谱的记忆账本。**

使用注意事项：小铅笔或底部栏编辑完插件标签并保存后，记得像玩变量卡一样，按底部栏的刷新键，插件会读取修改过的内容做更新。

---

## 亮点功能

**美化自定义（新）**
喜欢漂亮且风格统一？现在 Horae 拥有了独立的**主题系统**！内置三套预设，支持一键切换日夜模式。觉得不够？支持导入/导出主题 JSON 与社区分享，还能手写 CSS 代码微调样式。配合**可调节的面板宽度**，无论是硬核魔改还是简单配置，都能让你的记忆面板赏心悦目。

**AI 智能摘要（新）**
旧档案没用过 Horae？一键批量扫描全部历史消息，AI 自动提取剧情事件和物品变化，生成完整的时间线。支持自定义每批 Token 上限适配不同模型，不满意可一键撤销。

**告别"永远的昨天"**
插件自动计算相对时间，注入"昨天"、"上周三"、"上个月15号"这样的生活化表述。AI 终于能分清前天和上周了。支持现代、历史、奇幻架空等多种日历体系。

**衣服不再乱穿**
每位角色的当前穿着被锁定记录，且只发送在场角色的服装。角色不会再莫名其妙换昨天的衣服，也不会把不在场的人的衣服发给 AI 浪费 token。

**NPC 不会越写越糊**
外貌、性格、关系等字段独立追踪。年龄还会随剧情时间自动推进。严格订立了关系的 prompt，不再上一秒 Char 欠 User 钱，下一秒 AI 输出说是 User 欠 Char 钱来颠倒关系。

**物品栏终于靠谱了**
带唯一编号的物品系统，分一般/重要/关键三级。智能解析数量变化（5斤→4斤），自动检测"已消耗"等状态并移除。

**待办事项防遗忘**
AI 可以自动记录剧情中的约定和伏笔，完成后自动删除。再也不用担心 AI 忘记两周前约好的约会。

**宝宝辅食级自定义表格**
Excel 风格的自由表格，想加行加行想加列加列，配上填写提示词让 AI 自动填。课程表、角色关系、任务清单……你能想到的都能做。删除消息时 AI 填的内容自动回退，你自己填的始终保留。

**变化驱动，省 Token**
AI 只输出本回合变化的信息，不再每次重复整个状态。每种数据都有明确的触发规则，减少无效输出。**不用额外耗费生成次数** —— 插件在 AI 正常回复时自动解析记忆节点，零额外开销。

**截断/改写也不怕**
中途被截断或自己手动改写了部分剧情？底部栏内置 **AI 分析**功能，只需一次生成就能智能补全该条消息的记忆节点。

**界面简单，萌新友好**
底部栏一目了然，顶部面板分页清晰。无需复杂配置，安装即用。

**发送内容自由控制**
在设置中自由选择哪些数据发送给 AI、哪些不发送 —— 不需要角色追踪？关掉。不需要物品栏？关掉。按需组合，节省 token。

---

## 快速安装

1. 打开 SillyTavern → 顶部扩展面板（积木图标）→ 「安装扩展」
2. 粘贴本仓库的 Git 链接，点击安装
3. 安装完成后刷新页面即可使用

> 配套正则会在插件首次加载时**自动注入**，无需手动导入。



---

## v1.1.0 更新内容

- **AI 智能摘要**：批量分析历史消息，自动提取剧情事件和物品，支持自定义 Token 分批上限，可一键撤销
- **Token计数器**：显示发送给AI的总prompt量，位置在设置下方。附带一提，目前插件果奔时发送prompt 3,591 Token
- **swipe适配**：修复了右滑生成新分页时，旧分页的记忆数据会被带入新生成的问题。现在swipe生成时会自动排除当前分页的旧记忆，确保AI基于正确的上下文生成全新的剧情分支
- **美化兼容**：插件 UI 样式与外部美化主题隔离，不再出现黑底黑字或白底白字
- **正则修改**：把<horaeevent>也设置为不发送给AI，更省Token
- **描述修正**：把某些功能的描述更正为更准确的描述方式

---

## v1.2.0 更新内容

- **自定义提示词**：设置中新增提示词编辑器，可自由修改系统注入提示词和 AI 摘要提示词，支持 `{{user}}`/`{{char}}` 变量，可以一键恢复默认，方便微调
- **AI 摘要功能新增**：现在可以中断生成了，并配置了弹窗新增「NPC 角色信息」和「好感度」勾选项。默认关闭，按需开启
- **摘要审阅弹窗**：AI 智能摘要完成后弹出审阅视窗，按「剧情轨迹 / 物品 / 角色 / 好感度」分类展示结果。逐条删除不满意的内容，点「补充摘要」只对删除项重跑 AI
- **好感度显示开关**：好感度区域新增小眼睛按钮，可点击隐藏/显示角色好感度
- **好感度删除**：编辑好感度弹窗新增删除键，可以自行删除AI生成错误产生错误的项目
- **美化兼容**：强调了CHECKBOX内部的字色，不再出现白底白勾

---

## v1.3.0 更新内容

- **全局表格**：自定义表格新增「全局」和「本地」两种作用域。全局表格跨角色卡共享，适合记录固定数据（如角色 ID 表）。点击表格名称前的图标可切换
- **行列锁定**：右键/长按表格单元格可锁定行、列或单个格子，防止 AI 修改。锁定内容在 prompt 中标记 🔒，AI 会跳过写入
- **一键清空表格**：表格操作栏新增橡皮擦按钮，清除所有数据区内容但保留表头，方便让 AI 重新填表
- **主题系统**：内置「樱花粉」「森林绿」「海洋蓝」三套预设主题，下拉即用。支持导入/导出自定义美化 JSON 文件，方便社区共享主题
- **美化导航**：新增 `THEME.md` 文档，列出全部 CSS 变量、主要容器类名和美化文件格式，方便用户自制主题
- **日夜模式**：设置中可切换日间/夜间模式，仅影响插件界面
- **自定义 CSS**：设置中可输入额外 CSS 代码微调插件样式
- **右键菜单修复**：修复右键菜单透明的问题（CSS 变量作用域未覆盖 `document.body` 级元素）
- **样式隔离增强**：所有按钮替换为插件专属类名，顶栏图标不再受浅色模式影响
- **消息面板宽度**：设置中可自定义消息面板宽度（50-100%）
- **正则置底**：插件正则启动时自动移至列表末尾，减少与其他正则冲突
- **时间线多选**：时间线事件支持长按多选批量删除（避免误触做了较长的触发时间）

---

## 兼容性

- **SillyTavern**: 1.12.0+
- **平台**: 电脑端 + 移动端双端适配

---

有 bug 或建议欢迎反馈！

**作者：SenriYuki**
